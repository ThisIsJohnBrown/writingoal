<div data-toggle="collapse" class="goal-bar" data-target="#collapse{{ goal.id }}">
  <div class="span2 goal-title"><span class="btn">{{goal.name}}</span></div>
  <div class="progress progress-striped">
    {% if goal.percent_goal > goal.percent_actual %}
      <div class="bar" style="width: {{goal.percent_actual}}%;" rel="tooltip" title="{{goal.num_written}} words"></div>
      <div class="bar bar-danger" style="width: {{goal.percent_diff}}%;" rel="tooltip" title="{{goal.words_behind}} words behind"></div>
    {% else %}
      <div class="bar" style="width: {{goal.percent_goal}}%;" rel="tooltip" title="{{goal.words_goal}} words"></div>
      <div class="bar bar-success" style="width: {{goal.percent_diff}}%;" rel="tooltip" title="{{goal.words_ahead}} words ahead"></div>
    {% endif %}
    {% for subgoal in goal.subgoals %}
      {% if subgoal.subgoal_is_active %}
      <div class="subgoal-marker-holder">
        <div class="subgoal-overlay"> </div>
        <div class="subgoal-marker subgoal-start" rel="tooltip" data-perc="{{ subgoal.percent_actual }}" title="{{subgoal.name}} - {{ subgoal.percent_subgoal_progress}}% completed"><i class="icon-caret-up"></i></div>
        <div class="subgoal-marker subgoal-end" data-perc="{{ subgoal.percent_actual_subgoal_end }}" rel="tooltip" title="{{subgoal.name}} - Goal at {{ subgoal.subgoal_target }} words{% if subgoal.percent_subgoal_progress < 100 and subgoal.end_date %}<br>{{ subgoal.days_remaining }} day{{ subgoal.days_remaining|pluralize }} left{% endif %}"><i class="icon-caret-up"></i></div>
      </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
 
<div id="collapse{{ goal.id }}" class="collapse data-holder">
  <div class="row">
    <a href="#modal-create-subgoal" role="button" class="span2 btn btn-large btn-success right open-subgoal-modal" data-toggle="modal" data-goal="{{ goal.id }}">+ New SubGoal</a>
  </div>
  <div class="row data-holder-row">
    <div class="span5 summary">
      <p>Goal Summary 
        <a href="#modal-update-goal" data-name="{{goal.name}}" data-words="{{goal.num_words}}" data-start="{{goal.start_date|date:"m/d/Y"}}" data-end="{{goal.end_date|date:"m/d/Y"}}" data-days="{{goal.days}}" data-toggle="modal" data-id="{{goal.id}}" class="update-goal"><i class="icon-edit"></i></a>
        <a href="#modal-delete-goal" data-toggle="modal" data-id="{{goal.id}}" class="delete-goal"><i class="icon-trash"></i></a>
      </p>
      <p class="inset">{{ goal.num_words }} words in {{ goal.days }} days</p>
      <p class="inset">{{ goal.average }} words per day</p>
      
      {% if goal.subgoals %}
        <p class="title">Subgoals</p>

        {% for goal in goal.subgoals %}
          <p class="inset">{{ goal.name }}
            <a href="#modal-update-goal" data-name="{{goal.name}}" data-words="{{goal.num_words}}" data-start="{{goal.start_date|date:"m/d/Y"}}" data-end="{{goal.end_date|date:"m/d/Y"}}" data-days="{{goal.days}}" data-toggle="modal" data-id="{{goal.id}}" class="update-goal"><i class="icon-edit"></i></a>
            <a href="#modal-delete-goal" data-toggle="modal" data-id="{{goal.id}}" data-subgoal="true" data-parent-id="{{ goal.parent_goal.id }}" class="delete-goal"><i class="icon-trash"></i></a>
          </p>
          <p class="inset">{{ goal.num_words }} words{% if goal.days %} in {{ goal.days }} days{% endif %}</p>
          {% if goal.days %}<p class="inset">{{ goal.average }} words per day{% endif %}</p>
        {% endfor %}
      {% endif %}

      {% if goal.days_progress >= 0 %}

        <p class="title">Progress</p>
        <p class="inset">{{ goal.num_written }} words written in {{ goal.days_progress }} days</per>
        <p class="inset">{{ goal.average_written }} words per day

        <p class="title">To Finish</p>
        <p class="inset">{{ goal.num_remaining }} words and {{ goal.days_remaining }} days left</p>
        <p class="inset">{{ goal.average_remaining }} words per day</p>
      {% else %}
        <p class="title">Starts in {{goal.days_until}} day{{goal.days_until|pluralize}}</p>
      {% endif %}
    </div>
    <div class="span5 entries">
      {% if goal.days_progress >= 0 %}
        <div class="input-append">
          <input class="span2 entry-add-{{goal.id}}" type="text">
          <button class="btn entry-add btn-success" type="button" data-input-class="input.entry-add-{{goal.id}}" data-goal-id="{{goal.id}}" data-entry-url="{% url entry_create %}" data-entry-list=".entry-list{{goal.id}}">Add words!</button>
        </div>
      
        {% if goal.entries %}
  	      <p class="entry-list-header"><i class="icon-play"></i> Entries</p>
  	      <div class="entry-list collapse">
  		      {% for entry in goal.entries %}
              {% ifchanged entry.entry_date.date %}
                {% if forloop.counter0 != 0 %}
                </div>
                {% endif %}
                <div class="row entry-list-day-header" data-collapse-name=".days.entry-day-{{ entry.entry_date|date:"Ymd" }}-{{goal.id}}">
                  <div class="span2"><span class="entry-date"><i class="icon-play"></i> {{ entry.entry_date|date:"M j, Y" }}</span></div>
                  <div class="span1 words entry-day-{{ entry.entry_date|date:"Ymd" }}-{{goal.id}}">{{entry.daily_num_words}}</div>
                  <div class="span2">
                    <div class="progress progress-striped">
                      <div class="bar entry-day-{{ entry.entry_date|date:"Ymd" }}-{{goal.id}}" style="width: {{entry.daily_percent}}%;"></div>
                    </div>
                  </div>
                </div>
                <div class="collapse days entry-day-{{ entry.entry_date|date:"Ymd" }}-{{goal.id}}">
              {% endifchanged %}
                  <div class="row day" data-entry-id="{{entry.id}}">
      		          <div class="span2"><span class="time">{{ entry.entry_date|date:"g:iA" }}</span></div>
                    <div class="span1 words"><span class="word-count">{{entry.num_words}}</span><input class="hidden" type="text" value="{{entry.num_words}}"></div>
                    <div class="span2 start-icons">
                      <a class="edit-word-count" href="#"><i class="icon-edit"></i></a>
                      <a href="#" class="delete-entry"><i class="icon-trash"></i></a>
                    </div>
                    <div class="span2 edit-icons hidden">
                      <a class="update-entry" href="#" data-words-name=".words.entry-day-{{ entry.entry_date|date:"Ymd" }}-{{goal.id}}" data-progress-name=".bar.entry-day-{{ entry.entry_date|date:"Ymd" }}-{{goal.id}}"><i class="icon-check"></i></a>
                      <a href="#" class="cancel-entry-update"><i class="icon-remove-sign"></i></a>
                    </div>
                  </div>
  		      {% endfor %}
            </div>
  	  	  </div>
    	  {% endif %}
      {% endif %}
    </div>
  </div>
</div>